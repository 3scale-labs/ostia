apiVersion: v1
kind: Template
metadata:
  creationTimestamp: null
  name: echo-api
  annotations:
    description: "3scale Echo API"
    iconClass: "icon-ruby"
    tags: "api,echo-api,3scale"
objects:
- apiVersion: v1
  kind: Service
  metadata:
    name: echo-api
  spec:
    ports:
    - name: echo-api-port
      port: 80
      protocol: TCP
      targetPort: 9292
    selector:
      deploymentconfig: echo-api
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    name: echo-api
  spec:
    replicas: 1
    selector:
      deploymentconfig: echo-api
    strategy:
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 180
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        labels:
          deploymentconfig: echo-api
      spec:
        containers:
        - image: ${ECHOAPI_IMAGE}
          imagePullPolicy: IfNotPresent
          name: echo-api
          livenessProbe:
            tcpSocket:
              port: 9292
            initialDelaySeconds: 10
            timeoutSeconds: 1
          readinessProbe:
            httpGet:
              path: /test/200
              port: 9292
            initialDelaySeconds: 15
            timeoutSeconds: 1
          ports:
          - containerPort: 9292
            protocol: TCP
        imagePullSecrets:
          - name: quay-auth
    triggers:
    - type: ConfigChange
parameters:
- name: ECHOAPI_IMAGE
  description: "Docker image to the Echo API"
  value: "quay.io/3scale/echoapi:master"
  required: true